!function(t){var e={};function i(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n=8,a=8,r=6,o=1,s="#cc4d4d",h=[500,2e3],c=[.05,.25],l=1;function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var f=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.scaleX=0,this.scaleY=0,this.state=t.VALUE.NONE,this.value=t.VALUE.NONE}var e,i,n;return e=t,n=[{key:"getGraphics",value:function(e){if(!t.BUFFER[e]){var i=.5*r,n=document.createElement("canvas");n.width=n.height=r;var a=n.getContext("2d");a.fillStyle=e==t.VALUE.PLAYER_1?"#ffffff":"#000000",a.beginPath(),a.arc(i,i,i,0,2*Math.PI),a.fill(),t.BUFFER[e]=n}return t.BUFFER[e]}}],(i=[{key:"draw",value:function(e){if(this.state!=t.VALUE.NONE){var i=t.getGraphics(this.state),n=i.width*(1-this.scaleX)*.5,a=i.height*(1-this.scaleY)*.5;e.drawImage(i,this.x+n,this.y+a,i.width*this.scaleX,i.height*this.scaleY)}}}])&&u(e.prototype,i),n&&u(e,n),t}();function v(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}f.BUFFER={},f.VALUE={NONE:0,PLAYER_1:1,PLAYER_2:2};var p=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=e,this.height=i}var e,i,r;return e=t,(i=[{key:"draw",value:function(t,e,i){var r=n+1,s=a+o,h=n*a+(n+1)*o,l=.5*o;t.globalAlpha=1,t.lineWidth=o,t.strokeStyle="#8c2e2e",t.beginPath();for(var u=0;u<r;u++)t.moveTo(l+u*s,0),t.lineTo(l+u*s,h),t.moveTo(0,l+u*s),t.lineTo(h,l+u*s);t.stroke(),t.fillStyle=e==f.VALUE.PLAYER_1?"#ffffff":"#000000",i.forEach(function(e){t.globalAlpha=c[0]+(c[1]-c[0])*e.weightMax,t.fillRect(e.x*a+(e.x+1)*o,e.y*a+(e.y+1)*o,a,a)}),t.globalAlpha=1}}])&&v(e.prototype,i),r&&v(e,r),t}();function E(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(e,i,n,a,r,o,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.obj=e,this.prop=i,this.duration=a,this.ease=o,this.from=e[i],this.to=n,this.time=-r,this.per=0,this.onComplete=s}var e,i,n;return e=t,(i=[{key:"update",value:function(t){this.time+=t,this.per=Math.max(0,Math.min(1,this.time/this.duration)),this.obj[this.prop]=this.from+(this.to-this.from)*this.ease(this.per),1==this.per&&this.onComplete&&this.onComplete(this)}}])&&E(e.prototype,i),n&&E(e,n),t}();function y(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}d.EASE={LINEAR:function(t){return t},IN_QUAD:function(t){return t*t},OUT_QUAD:function(t){return t*(2-t)},INOUT_QUAD:function(t){return t<.5?2*t*t:(4-2*t)*t-1}};var g=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.main=e}var e,i,n;return e=t,(i=[{key:"doMove",value:function(e,i,n){var a=this,r=this.getChip(e,i),o=!1;return r.value==f.VALUE.NONE&&(Object.keys(t.DIRECTION).forEach(function(r){for(var s=t.DIRECTION[r],h=e+s.X,c=i+s.Y,l=a.getChip(h,c),u=l,v=[];l&&l.value!=f.VALUE.NONE&&l.value!=n;)v.push(l),h+=s.X,c+=s.Y,l=a.getChip(h,c);l&&l!=u&&l.value==n&&(v.forEach(function(t,e){var i=Math.random()>.5?"scaleX":"scaleY";a.main.animations.push(new d(t,i,0,100,100*e,d.EASE.IN_QUAD,function(){t.state=n,a.main.animations.push(new d(t,i,1,100,0,d.EASE.OUT_QUAD))})),t.value=n}),o=!0)}),o&&(r.state=r.value=n,this.main.animations.push(new d(r,"scaleX",1,100,0,d.EASE.LINEAR)),this.main.animations.push(new d(r,"scaleY",1,100,0,d.EASE.LINEAR))),o)}},{key:"getValidMoves",value:function(e){var i=this,n=[];this.main.chips.forEach(function(a,r){a.forEach(function(a,o){a.value==f.VALUE.NONE&&Object.keys(t.DIRECTION).forEach(function(a){for(var s=t.DIRECTION[a],h=o+s.X,c=r+s.Y,l=i.getChip(h,c),u=l,v=[];l&&l.value!=f.VALUE.NONE&&l.value!=e;)v.push(l),h+=s.X,c+=s.Y,l=i.getChip(h,c);if(l&&l!=u&&l.value==e){var p=n.find(function(t){return t[0]==o&&t[1]==r});p?p[2]+=v.length:n.push({x:o,y:r,captures:v.length})}})})});var a=Math.max.apply(Math,y(n.map(function(t){return t.captures})).concat([0])),r=n.reduce(function(t,e){return t+e.captures},0);return n.forEach(function(t){t.weightMax=t.captures/a,t.weightTotal=t.captures/r}),n}},{key:"getChip",value:function(t,e){return this.main.chips[e]&&this.main.chips[e][t]}},{key:"getScore",value:function(t){var e=0;return this.main.chips.forEach(function(i){return i.forEach(function(i){i.value==t&&e++})}),e}}])&&m(e.prototype,i),n&&m(e,n),t}();function A(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}g.DIRECTION={LEFT:{X:-1,Y:0},TOP_LEFT:{X:-1,Y:-1},TOP:{X:0,Y:-1},TOP_RIGHT:{X:1,Y:-1},RIGHT:{X:1,Y:0},BOTTOM_RIGHT:{X:1,Y:1},BOTTOM:{X:0,Y:1},BOTTOM_LEFT:{X:-1,Y:1}};var b=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.playing=!1,this.delay=0,this.move=null}var e,i,n;return e=t,(i=[{key:"getMove",value:function(t,e,i,n){this.playing=!0,this.delay=i[0]+Math.random()*(i[1]-i[0]);var a=Math.max.apply(Math,A(t.map(function(t){return t.weightMax})).concat([0])),r=t[0];switch(e){case"random":r=t[Math.floor(Math.random()*t.length)];break;case"weighted_random":for(var o=0,s=t.map(function(t){var e=Math.pow(t.weightTotal,5);return o+=e,e}),h=Math.random()*o,c=0,l=0;l<t.length;l++)if(h<=(c+=s[l])){r=t[l];break}break;case"max_weight":var u=t.filter(function(t){return t.weightMax==a});r=u[Math.floor(Math.random()*u.length)]}this.move={x:r.x,y:r.y,callback:n}}},{key:"update",value:function(t){this.playing&&(this.delay-=t,this.delay<=0&&(this.playing=!1,this.move.callback(this.move.x,this.move.y)))}}])&&w(e.prototype,i),n&&w(e,n),t}();function L(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}new(function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n<6||n%2!=0)throw Error("Invalid field count");if(a%2!=0)throw Error("Invalid field size");if(r>a||r%2!=0)throw Error("Invalid chip size");if(h[0]>h[1])throw Error("Invalid AI move delay");if(c[0]>c[1])throw Error("Invalid hint alpha");var e=.5*(a-r);this.canvas=document.querySelector("#canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.canvas.width=n*a+(n+1)*o,this.canvas.height=this.canvas.width+2*o+l,this.gameloop=this.update.bind(this),this.prevTime=0,this.winner=null,this.animations=[],this.validMoves=[],this.score={animation:null,ratio:.5},this.currPlayer=f.VALUE.PLAYER_1,this.logic=new g(this),this.ai=new b,this.grid=new p(this.canvas.width,this.canvas.height),this.chips=new Array(n).fill(null).map(function(t,i){return new Array(n).fill(null).map(function(t,n){return new f(n*a+(n+1)*o+e,i*a+(i+1)*o+e)})}),this.reset(),this.canvas.addEventListener("click",this.click.bind(this)),window.addEventListener("resize",this.resize.bind(this)),document.body.style.backgroundColor=s,this.resize(),this.gameloop(0)}var e,i,u;return e=t,(i=[{key:"reset",value:function(){this.currPlayer=f.VALUE.PLAYER_1,this.winner=null,this.chips.forEach(function(t){return t.forEach(function(t){return t.value=t.state=f.VALUE.NONE})});var t=.5*n,e=this.chips[t-1][t-1];e.state=e.value=f.VALUE.PLAYER_1,e.scaleX=e.scaleY=1;var i=this.chips[t-1][t];i.state=i.value=f.VALUE.PLAYER_2,i.scaleX=i.scaleY=1;var a=this.chips[t][t];a.state=a.value=f.VALUE.PLAYER_1,a.scaleX=a.scaleY=1;var r=this.chips[t][t-1];r.state=r.value=f.VALUE.PLAYER_2,r.scaleX=r.scaleY=1,this.score.ratio=.5,this.score.animation=null,this.validMoves=this.logic.getValidMoves(this.currPlayer),this.checkAIMove()}},{key:"click",value:function(t){if(t&&t.preventDefault(),!this.ai.playing){if(this.winner)return this.reset();var e=a+o,i=.5*o,r=Math.max(0,Math.min(Math.floor((t.offsetX-i)/e),n-1)),s=Math.max(0,Math.min(Math.floor((t.offsetY-i)/e),n-1));this.logic.doMove(r,s,this.currPlayer)&&this.onMoved()}}},{key:"checkAIMove",value:function(){var t=this;this.currPlayer,f.VALUE.PLAYER_1,this.currPlayer==f.VALUE.PLAYER_2&&this.ai.getMove(this.validMoves,this.currPlayer==f.VALUE.PLAYER_1?"random":"weighted_random",h,function(e,i){t.logic.doMove(e,i,t.currPlayer),t.onMoved()})}},{key:"onMoved",value:function(){this.currPlayer=this.currPlayer==f.VALUE.PLAYER_1?f.VALUE.PLAYER_2:f.VALUE.PLAYER_1,this.validMoves=this.logic.getValidMoves(this.currPlayer);var t=this.logic.getScore(f.VALUE.PLAYER_1),e=this.logic.getScore(f.VALUE.PLAYER_2);this.validMoves.length?this.checkAIMove():this.winner=t==e?f.VALUE.NONE:t>e?f.VALUE.PLAYER_1:f.VALUE.PLAYER_2,this.score.animation=new d(this.score,"ratio",t/(t+e),500,0,d.EASE.INOUT_QUAD)}},{key:"update",value:function(t){var e=this,i=t-this.prevTime;this.prevTime=t,this.ai.update(i),this.animations.forEach(function(t){return t.update(i)}),this.animations=this.animations.filter(function(t){return t.per<1}),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.grid.draw(this.ctx,this.currPlayer,this.validMoves),this.chips.forEach(function(t){return t.forEach(function(t){return t.draw(e.ctx)})}),this.score.animation&&(this.score.animation.update(i),this.score.animation.per>=1&&(this.score.animation=null));var n=Math.round((this.canvas.width-2*o)*this.score.ratio);this.ctx.lineWidth=l,this.ctx.strokeStyle="#ffffff",this.winner!=f.VALUE.PLAYER_1&&this.winner!=f.VALUE.NONE||(this.ctx.globalAlpha=.5*(1+Math.sin(t/100))),this.ctx.beginPath(),this.ctx.moveTo(o,this.canvas.height-l+.5*l),this.ctx.lineTo(o+n,this.canvas.height-l+.5*l),this.ctx.stroke(),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#000000",this.winner!=f.VALUE.PLAYER_2&&this.winner!=f.VALUE.NONE||(this.ctx.globalAlpha=.5*(1+Math.sin(t/100))),this.ctx.beginPath(),this.ctx.moveTo(o+n,this.canvas.height-l+.5*l),this.ctx.lineTo(this.canvas.width-o,this.canvas.height-l+.5*l),this.ctx.stroke(),this.ctx.globalAlpha=1,requestAnimationFrame(this.gameloop)}},{key:"resize",value:function(){var t=.9*window.innerWidth/this.canvas.width,e=.9*window.innerHeight/this.canvas.height,i=Math.min(t,e);i=Math.min(5,i),this.canvas.style.transform="scale(".concat(i,")")}}])&&L(e.prototype,i),u&&L(e,u),t}())}]);